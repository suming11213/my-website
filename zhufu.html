<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>小涵 · 2026 马年万灯祈愿</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gate-red: #630800;
            --gold: #FFD700;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            font-family: 'Noto Serif SC', serif;
            overflow: hidden; height: 100vh; width: 100vw; position: relative;
        }

        /* --- 层级管理 --- */
        #bg-lanterns { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none; overflow: hidden; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: auto; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; pointer-events: none; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #hero-lantern-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; pointer-events: none; }
        #gate-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 200; display: flex; perspective: 1000px; }

        /* --- 1. 朱红大门 --- */
        .gate {
            width: 50%; height: 100%;
            background: linear-gradient(to right, #630800, #9e1b10);
            position: relative; border: 3px solid #3e0000;
            display: flex; align-items: center; justify-content: center;
            transition: transform 2s ease-in-out;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.8);
        }
        .gate-left { transform-origin: left; border-right: 4px solid var(--gold); }
        .gate-right { transform-origin: right; border-left: 4px solid var(--gold); }
        .gate-open .gate-left { transform: rotateY(-105deg); }
        .gate-open .gate-right { transform: rotateY(105deg); }

        .nails {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            background-image: radial-gradient(#3a0000 20%, transparent 25%);
            background-size: 60px 60px; opacity: 0.4;
        }
        
        .knocker {
            width: 100px; height: 100px; border-radius: 50%;
            background: radial-gradient(#ffd700, #b8860b);
            border: 4px solid #5a0000; position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); z-index: 2;
        }
        .knocker-ring {
            width: 70px; height: 70px; border: 6px solid #ffd700; border-radius: 50%;
            position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%);
        }

        .couplet {
            position: absolute; top: 15%; width: 50px; padding: 25px 0;
            background: #900; color: #FFD700; border: 1px solid #ffcc00; border-radius: 4px;
            font-family: 'Ma Shan Zheng'; font-size: 1.4rem; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.6); z-index: 5;
            text-shadow: 1px 1px 0 #000;
        }

        /* --- 2. 漫天背景花灯 (精致版) --- */
        .small-lantern {
            position: absolute;
            /* 核心美感：径向渐变模拟灯芯光芒 */
            background: radial-gradient(circle at 50% 50%, #fffde7 0%, #ffc107 40%, #ff5722 90%);
            width: 46px; height: 68px;
            /* 造型：圆润的纸灯笼 */
            border-radius: 12px 12px 20px 20px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.6); /* 发光 */
            animation: floatUp linear forwards, sway 5s ease-in-out infinite alternate;
        }
        /* 上下深色边框模拟木质结构 */
        .small-lantern::before {
            content:''; position: absolute; top: -4px; width: 60%; height: 5px; 
            background: #4a0000; border-radius: 2px;
        }
        .small-lantern::after {
            content:''; position: absolute; bottom: -4px; width: 45%; height: 5px; 
            background: #4a0000; border-radius: 2px;
        }
        /* 祝福文字 */
        .small-lantern-text {
            font-family: 'Ma Shan Zheng'; font-size: 16px; color: #4a0000;
            writing-mode: vertical-rl; font-weight: bold;
            text-shadow: 0 0 2px rgba(255,255,255,0.5);
            letter-spacing: 2px;
        }

        @keyframes floatUp { to { transform: translateY(-120vh) rotate(5deg); opacity: 0; } }
        @keyframes sway { 
            0% { margin-left: -10px; transform: rotate(-3deg); } 
            100% { margin-left: 10px; transform: rotate(3deg); } 
        }

        /* --- 3. 祝福语 --- */
        .blessing-box {
            background: rgba(0, 0, 0, 0.2); 
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            width: 90%; max-width: 500px;
            backdrop-filter: blur(4px);
            transition: opacity 1.5s ease;
        }
        .blessing-line {
            font-family: 'Ma Shan Zheng', cursive;
            color: #FFD700; font-size: 1.8rem; line-height: 1.8;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            opacity: 0; transform: translateY(10px);
            transition: all 0.6s ease;
        }

        /* --- 4. 按钮 --- */
        .btn-wrapper {
            position: absolute; bottom: 15%;
            opacity: 0; transform: translateY(20px);
            transition: all 1s ease; pointer-events: none;
        }
        .wish-btn {
            background: linear-gradient(135deg, #d4145a, #fbb03b);
            border: 2px solid #fff; color: #fff;
            padding: 14px 45px; border-radius: 50px;
            font-family: 'Ma Shan Zheng'; font-size: 1.3rem;
            cursor: pointer; box-shadow: 0 0 25px rgba(212, 20, 90, 0.6);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 50% { transform: scale(1.05); } }

        /* --- 5. 主角大花灯 (帝王级) --- */
        .hero-lantern {
            position: absolute; left: 50%; bottom: -600px;
            transform: translateX(-50%) scale(0.5);
            width: 220px; height: 300px;
            background: radial-gradient(circle at 50% 50%, #fff 0%, #ffc107 40%, #ff5722 90%);
            border-radius: 60px 60px 70px 70px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 100px rgba(255, 215, 0, 0.9), inset 0 0 30px rgba(255,255,255,0.8);
            /* 极速升空 Transition */
            transition: bottom 1.2s cubic-bezier(0.2, 0.8, 0.2, 1), transform 1.2s ease-out;
            z-index: 100;
        }
        .hero-lantern::before {
            content:''; position: absolute; width:100%; height:100%;
            border-radius: 60px 60px 70px 70px;
            border: 4px double rgba(160, 0, 0, 0.2);
        }
        .hero-lantern::after {
            content: ''; position: absolute; bottom: -120px;
            width: 12px; height: 120px; background: #ffd700;
            box-shadow: 0 0 15px #ffd700;
        }
        .hero-text {
            font-family: 'Ma Shan Zheng'; font-size: 2.2rem; color: #630800;
            writing-mode: vertical-rl; font-weight: bold; letter-spacing: 8px;
            text-shadow: 0 0 5px rgba(255,255,255,0.8); z-index: 2;
        }

        /* 弹窗 */
        .modal {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.7); z-index: 300; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(6px);
        }
        .input-card {
            background: #fffdf0; padding: 35px; border-radius: 20px; width: 85%; max-width: 380px;
            text-align: center; border: 3px solid #b8860b;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

    </style>
</head>
<body>

    <!-- 1. 朱红大门 -->
    <div id="gate-layer" onclick="openGate()">
        <div class="gate gate-left">
            <div class="nails"></div>
            <div class="couplet" style="right: 35px;">金蛇辞旧岁</div>
            <div class="knocker"><div class="knocker-ring"></div></div>
        </div>
        <div class="gate gate-right">
            <div class="nails"></div>
            <div class="couplet" style="left: 35px;">骏马迎新春</div>
            <div class="knocker"><div class="knocker-ring"></div></div>
        </div>
        <div style="position:absolute; bottom:60px; color:#FFD700; font-family:'Ma Shan Zheng'; font-size:1.2rem; animation:pulse 1s infinite; text-shadow: 0 2px 4px black;">点击开启 2026</div>
    </div>

    <!-- 2. 背景漫天小花灯 (带字+美化) -->
    <div id="bg-lanterns"></div>

    <!-- 3. 烟花 -->
    <canvas id="fireworks"></canvas>

    <!-- 4. UI 内容 -->
    <div id="ui-layer">
        <div class="blessing-box" id="blessing-box"></div>
        <div class="btn-wrapper" id="btn-wrapper">
            <button class="wish-btn" onclick="openModal()">✨ 写下小涵的新年愿望 ✨</button>
        </div>
    </div>

    <!-- 5. 主角大花灯 -->
    <div id="hero-lantern-layer"></div>

    <!-- 6. 弹窗 -->
    <div class="modal" id="modal">
        <div class="input-card">
            <h3 style="color:#8E0E00; font-family:'Ma Shan Zheng'; margin-bottom:20px; font-size:1.5rem;">马年祈愿</h3>
            <input type="text" id="wishInput" placeholder="输入愿望 (如: 暴富暴美)" maxlength="8"
                   style="width:100%; padding:12px; font-size:1.2rem; text-align:center; border:1px solid #ddd; border-radius:8px; margin-bottom:25px; outline:none; background:#fff;">
            <div style="display:flex; justify-content:center; gap:15px;">
                <button onclick="document.getElementById('modal').style.display='none'" style="background:#ccc; color:#fff; border:none; padding:10px 25px; font-size:1rem; border-radius:50px;">取消</button>
                <button onclick="launchWish()" style="background:#d4145a; color:#fff; border:none; padding:10px 35px; font-size:1.1rem; border-radius:50px; box-shadow:0 5px 15px rgba(212,20,90,0.4);">放飞</button>
            </div>
        </div>
    </div>

    <script>
        // --- 配置 ---
        const config = {
            text: [
                "致 <span style='color:#ff4d4d; font-size:2rem'>小涵</span> ：",
                "金蛇狂舞，辞旧迎新。",
                "2026 马年已至，",
                "愿这漫天花灯，",
                "带去我最深的祝福。",
                "所求皆如愿，",
                "所行化坦途。"
            ],
            // 小花灯上的随机词
            wishes: ["安康", "喜乐", "暴富", "顺遂", "上岸", "美丽", "好运", "发财", "脱单", "平安", "健康"]
        };

        const canvas = document.getElementById('fireworks');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let isHeroFlying = false;

        // --- 1. 开门流程 ---
        function openGate() {
            document.getElementById('gate-layer').classList.add('gate-open');
            // 立即开启背景灯和烟花
            startSkyLanterns(); 
            startFireworks();   
            
            setTimeout(() => {
                document.getElementById('gate-layer').style.display = 'none';
                startTypeWriter(); // 开始打字
            }, 1500);
        }

        // --- 2. 漫天背景灯 (美化逻辑) ---
        function createSmallLantern() {
            const container = document.getElementById('bg-lanterns');
            const el = document.createElement('div');
            el.className = 'small-lantern';
            
            // 随机分配祝福语
            const text = config.wishes[Math.floor(Math.random() * config.wishes.length)];
            el.innerHTML = `<span class="small-lantern-text">${text}</span>`;
            
            // 随机水平位置 (5% - 95%)
            el.style.left = Math.random() * 90 + 5 + '%';
            // 初始位置在底部下方
            el.style.bottom = '-100px';
            
            // 随机景深大小 (0.5 - 0.9)
            const scale = Math.random() * 0.4 + 0.5;
            el.style.transform = `scale(${scale})`;
            
            // 随机上升速度 (15-25秒)
            const duration = Math.random() * 10 + 15;
            el.style.animationDuration = duration + 's';
            
            // 随机延迟
            el.style.animationDelay = Math.random() * 2 + 's';
            
            container.appendChild(el);
            
            // 动画结束后销毁
            setTimeout(() => el.remove(), duration * 1000 + 2000);
        }

        function startSkyLanterns() {
            // 瞬间生成20个，分布在屏幕不同高度，避免开场空白
            for(let i=0; i<20; i++) {
                const el = document.createElement('div');
                el.className = 'small-lantern';
                const text = config.wishes[Math.floor(Math.random() * config.wishes.length)];
                el.innerHTML = `<span class="small-lantern-text">${text}</span>`;
                el.style.left = Math.random() * 90 + 5 + '%';
                // 随机高度铺满屏幕
                el.style.bottom = Math.random() * 100 + '%'; 
                const scale = Math.random() * 0.4 + 0.5;
                el.style.transform = `scale(${scale})`;
                el.style.animationDuration = (Math.random() * 10 + 15) + 's';
                document.getElementById('bg-lanterns').appendChild(el);
                
                // 它们已经有了 floatUp 动画，会接着往上飘
                setTimeout(() => el.remove(), 20000);
            }

            // 然后持续从底部生成
            setInterval(createSmallLantern, 800);
        }

        // --- 3. 祝福语 ---
        function startTypeWriter() {
            const box = document.getElementById('blessing-box');
            let lineIndex = 0;

            function nextLine() {
                if (lineIndex < config.text.length) {
                    const line = document.createElement('div');
                    line.className = 'blessing-line';
                    line.innerHTML = config.text[lineIndex];
                    box.appendChild(line);
                    line.offsetHeight;
                    line.style.opacity = 1;
                    line.style.transform = 'translateY(0)';
                    lineIndex++;
                    setTimeout(nextLine, 1000);
                } else {
                    // 打字结束，停留2.5秒
                    setTimeout(() => {
                        box.style.opacity = 0; // 渐隐
                        setTimeout(() => {
                            box.style.display = 'none'; 
                            showButton();
                        }, 1500);
                    }, 2500);
                }
            }
            nextLine();
        }

        function showButton() {
            const btn = document.getElementById('btn-wrapper');
            btn.style.opacity = 1;
            btn.style.transform = 'translateY(0)';
            btn.style.pointerEvents = 'auto';
        }

        // --- 4. 主角许愿 (极速版) ---
        function openModal() { document.getElementById('modal').style.display = 'flex'; }
        
        function launchWish() {
            const input = document.getElementById('wishInput');
            const text = input.value.trim() || "马到成功";
            document.getElementById('modal').style.display = 'none';
            document.getElementById('btn-wrapper').style.opacity = 0;
            
            isHeroFlying = true; // 烟花避让
            spawnHeroLantern(text);
        }

        function spawnHeroLantern(text) {
            const layer = document.getElementById('hero-lantern-layer');
            const el = document.createElement('div');
            el.className = 'hero-lantern';
            el.innerHTML = `<div class="hero-text">${text}</div>`;
            layer.appendChild(el);

            // 第一阶段：极速升空 (1.2秒)
            setTimeout(() => {
                el.style.bottom = '45%';
                el.style.transform = 'translateX(-50%) scale(1.1)';
            }, 50);

            // 第二阶段：0.8秒后飞走
            setTimeout(() => {
                // 切换为匀速飘走
                el.style.transition = "bottom 6s linear, transform 6s linear";
                el.style.bottom = '120%'; 
                el.style.transform = 'translateX(-50%) scale(0.6)';
                
                // 飞高后烟花庆祝
                setTimeout(() => {
                    isHeroFlying = false;
                    megaFirework();
                }, 1200);
            }, 2000); // 1.2s上升 + 0.8s停留
        }

        // --- 5. 烟花系统 ---
        let particles = [];
        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 5 + 2;
                this.vx = Math.cos(angle) * speed; this.vy = Math.sin(angle) * speed;
                this.alpha = 1; this.friction = 0.96; this.gravity = 0.05;
                this.decay = Math.random() * 0.01 + 0.01;
            }
            update() {
                this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity;
                this.x += this.vx; this.y += this.vy; this.alpha -= this.decay;
            }
            draw() {
                ctx.save(); ctx.globalCompositeOperation = 'lighter'; ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color; ctx.beginPath();
                ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2); ctx.fill(); ctx.restore();
            }
        }

        function createExplosion(x, y) {
            const colors = ['#FFD700', '#FF4500', '#00FFFF', '#FF69B4', '#FFFFFF'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            for(let i=0; i<80; i++) particles.push(new Particle(x, y, color));
        }

        function loop() {
            requestAnimationFrame(loop);
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0,0,0,0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            for(let i=particles.length-1; i>=0; i--) {
                particles[i].update(); particles[i].draw();
                if(particles[i].alpha <= 0) particles.splice(i, 1);
            }
        }
        loop();

        function startFireworks() {
            setInterval(() => {
                let x, y;
                if(isHeroFlying) { // 避让模式
                    if(Math.random() > 0.5) x = Math.random() * canvas.width * 0.25;
                    else x = canvas.width - Math.random() * canvas.width * 0.25;
                    y = Math.random() * canvas.height * 0.6;
                } else { // 全屏模式
                    x = Math.random() * canvas.width;
                    y = Math.random() * canvas.height * 0.6;
                }
                createExplosion(x, y);
            }, 800);
        }

        function megaFirework() {
            let count = 0;
            let t = setInterval(() => {
                createExplosion(Math.random()*canvas.width, Math.random()*canvas.height*0.5);
                count++; if(count > 10) clearInterval(t);
            }, 200);
        }
        
        canvas.addEventListener('click', e => createExplosion(e.clientX, e.clientY));
    </script>
</body>
</html>